# Palladio Quick Start


## Prerequisites

* RedHat Enterprise Linux 7 (and compatible) or Windows 10
* Houdini 18.0 or later
* To create CityEngine rule packages, an installation of CityEngine (2019.0 or later)
* For commercial work, a [license](https://esri.com/cityengine) for CityEngine (2019.0 or later)


## Installation

### From Pre-Built Binaries

1. [Download](https://esri.github.io/palladio/#downloads) Palladio 
1. Extract the archive into your `<home>\Documents\houdiniX.Y` (Windows) or `<home>/houdiniX.Y` (Linux) directory, so that the files end up in the `config`, `dso` and `packages` sub-directories.
1. Start Houdini and Palladio will be loaded automatically.

Note: it is NOT necessary to modify the system `PATH` environment variable.

### From Source

1. [Build](build.md) Palladio
1. The `install` step should automatically copy all required files into your `<home>\Documents\houdiniX.Y` (Windows) or `<home>/houdiniX.Y` (Linux) directory and Palladio is ready to run.


## Execute a simple CityEngine Rule
    
1. In CityEngine, create the following rule file and share it as a rule package (RPK) to disk somewhere (or download one of the provided examples):
   ```
   attr height = 1
   
   @StartRule
   Init -->
      extrude(height)
   ```
1. In Houdini, in a new scene, add a `grid` node.
1. Enter the `grid` node and add the two Palladio nodes `pldAssign` and `pldGenerate`. Connect them like this: ![](img/extrude01.png)
1. In the `pldAssign` node, set the `Rule Package` parameter to the path of the previously exported RPK.
1. Make the `pldGenerate` node the active render node, this will trigger a "cooking" of the assign and generate nodes and execute the CityEngine Rule. You should now see an extruded grid: ![](img/extrude02.png)

## Overriding Rule Attributes

In the previous section we've used the default value for the `height` attribute. Let's use Houdini tools to modify the rule attribute prior to execution.

1. Add an `AttributeCreate` node between `pldAssign` and `pldGenerate`.
1. Set the attribute name to `height` and the `Class` to `Primitive`. The extrusion vanishes because the default value is 0.
1. Increase the value for `height` to see an actual extrusion: ![](img/attribute02.png)

Please note the steps for the general case:
1. See the CGA file (or CityEngine) for the available attributes and their data types (number, string, boolean). 
1. In the `AttributeCreate` node, set `name` to the name of the CGA attribute (replace dots `.` with double underscores `__`).
1. Set `class` to `Primitive`.
1. Set `type` to `Float` for CGA number attributes, `String` for CGA strings and `Integer` with 8 bit precision for CGA booleans.

## Working with Material Attributes

Note: we provide a ready-made Houdini Digital Asset with a [CityEngine Material for Mantra](https://github.com/Esri/palladio/releases/download/v1.6.1/PalladioCityEngineMaterial-v2.hdanc).

In this section, we are going to connect a material attribute generated by `pldGenerate` with a Mantra shader (the same mechanism can also be used for Viewport materials).

1. Extend the rule from the first section with a `color` statement:
    ```
    attr height = 1

    @StartRule
    Init -->
       color(1,0,0)
       extrude(height)
    ```
    ![](img/materials01.png) 
1. In Houdini, select the `pldGenerate` node and check the `Emit material attributes` check box. Open the spreadsheet to observe a number of material primitive attributes now being emitted by `pldGenerate`.
1. Add a `Material` node and connect it to the `pldGenerate` node. Make it the active render node:
    
    ![](img/materials02.png)
1. In the `Material Palette`, create a new `Principled Shader` instance and call it `CityEngineShader`:

    ![](img/materials03.png)
1. Enter the `CityEngineShader` node and connect a `Parameter` node to the `Surface/basecolor` input:

    ![](img/materials04.png) 

1. Set the name of the `Parameter` node to `color` and also set the type to `Color`. This name will match the primitive attribute emitted by `pldGenerate`.

    ![](img/materials05.png)

1. Back in the network of the `grid` node, select the `Material` node and select `/mat/CityEngineShader` for the `Material` parameter.

1. Hit Mantra render and you should see a red box in the render view.

    ![](img/materials06.png)
